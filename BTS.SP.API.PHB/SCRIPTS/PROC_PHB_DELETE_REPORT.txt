create or replace PROCEDURE "PHB_DELETE_REPORT" 
(
  MA_BAO_CAO IN NVARCHAR2,
  REFID_BC IN NVARCHAR2,
  ISDELETED IN BOOLEAN
)AS
QUERY_STR  VARCHAR2(300); 
cur SYS_REFCURSOR;
BEGIN
IF(MA_BAO_CAO='BIEU3B') THEN 
    BEGIN
        SAVEPOINT sp_sptest;
        DELETE FROM PHB_BIEU3B WHERE REFID=''||REFID_BC||'';
        DELETE FROM PHB_BIEU3BP1_DETAIL WHERE PHB_BIEU3B_REFID=''||REFID_BC||'';
        DELETE FROM PHB_BIEU3BP2_DETAIL WHERE PHB_BIEU3B_REFID=''||REFID_BC||'';
        EXCEPTION
            WHEN OTHERS THEN
                ROLLBACK TO sp_sptest;
                RAISE; 
    END;
ELSE
    BEGIN
    QUERY_STR:='DELETE FROM '||MA_BAO_CAO||' INNER JOIN '||MA_BAO_CAO||'_DETAIL ON REFID='||MA_BAO_CAO||'_REFID WHERE REFID='''||REFID_BC||'''';
    DBMS_OUTPUT.PUT_LINE(QUERY_STR);
    EXECUTE IMMEDIATE QUERY_STR;
    END;
END IF;

END PHB_DELETE_REPORT;
